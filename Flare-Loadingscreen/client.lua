local a=GetGameTimer()local b=false;local c=GetCurrentResourceName()local d=Citizen.Wait;local e=Citizen.CreateThread;local f={}local g={active=true,volume=30}local h=false;local function i(...)if h then print("[FC-Loadingscreen]",...)end end;local function j()i("Loadingscreen wird initialisiert")d(100)SendNUIMessage({type='init',startTime=a,audioState=g})if f.audioState then g=f.audioState;d(300)SendNUIMessage({type='updateAudio',audioState=g})end;i("Loadingscreen initialisiert: "..GetGameTimer()-a.."ms")end;local function k()if b then return end;i("Beende Loadingscreen")SendNUIMessage({type='getAudioState'})d(150)SendNUIMessage({type='shutdown',fadeTime=1000})d(1200)ShutdownLoadingScreen()ShutdownLoadingScreenNui()b=true;i("Loadingscreen beendet: "..GetGameTimer()-a.."ms")end;RegisterNUICallback('audioStateChanged',function(l,m)if l and type(l)=="table"then if type(l.volume)=="number"and type(l.active)=="boolean"then g=l;f.audioState=l;i("Audio-Status aktualisiert: "..json.encode(g))else i("Fehlerhafte Audio-Daten")end end;m('ok')end)AddEventHandler('onClientResourceStart',function(n)if n~=c then return end;i("Resource gestartet: "..n)j()e(function()local o=250;local p=GetGameTimer()local q=60000;while true do d(o)if NetworkIsPlayerActive(PlayerId())then d(500)k()break end;if GetGameTimer()-p>q then i("Timeout erreicht")k()break end end end)end)AddEventHandler('onResourceStop',function(n)if n~=c then return end;i("Resource gestoppt - Cleanup")b=false;collectgarbage("collect")end)if h then RegisterCommand('reloadscreen',function()b=false;a=GetGameTimer()j()i("Loadingscreen neu geladen")end,false)RegisterCommand('testaudio',function()SendNUIMessage({type='updateAudio',audioState={active=true,volume=50}})i("Audio-Test ausgef√ºhrt")end,false)end